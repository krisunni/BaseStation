{"ts":1390534589134,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"var fs = require('fs')\r\n,http = require('http'),\r\nsocketio = require('socket.io'),\r\nurl = require(\"url\"), \r\nSerialPort = require(\"serialport\").SerialPort\r\n\r\nvar socketServer;\r\nvar serialPort;\r\nvar portName = 'COM3'; //change this to your Arduino port\r\nvar sendData = \"\";\r\n\r\n// handle contains locations to browse to (vote and poll); pathnames.\r\nfunction startServer(route,handle,debug)\r\n{\r\n\t// on request event\r\n\tfunction onRequest(request, response) {\r\n\t  // parse the requested url into pathname. pathname will be compared\r\n\t  // in route.js to handle (var content), if it matches the a page will \r\n\t  // come up. Otherwise a 404 will be given. \r\n\t  var pathname = url.parse(request.url).pathname; \r\n\t  console.log(\"Request for \" + pathname + \" received\");\r\n\t  var content = route(handle,pathname,response,request,debug);\r\n\t}\r\n\t\r\n\tvar httpServer = http.createServer(onRequest).listen(1337, function(){\r\n\t\tconsole.log(\"Listening at: http://localhost:1337\");\r\n\t\tconsole.log(\"Server is up\");\r\n\t}); \r\n\tserialListener(debug);\r\n\tinitSocketIO(httpServer,debug);\r\n}\r\n\r\nfunction initSocketIO(httpServer,debug)\r\n{\r\n\tsocketServer = socketio.listen(httpServer);\r\n\tif(debug == false){\r\n\t\tsocketServer.set('log level', 1); // socket IO debug off\r\n\t}\r\n\tsocketServer.on('connection', function (socket) {\r\n\tconsole.log(\"user connected\");\r\n\tsocket.emit('onconnection', {pollOneValue:sendData});\r\n\tsocketServer.on('update', function(data) {\r\n\tsocket.emit('updateData',{pollOneValue:data});\r\n\t});\r\n\tsocket.on('buttonval', function(data) {\r\n\t\tserialPort.write(data + 'E');\r\n\t});\r\n\tsocket.on('sliderval', function(data) {\r\n\t\tserialPort.write(data + 'P');\r\n\t});\r\n\t\r\n    });\r\n}\r\n\r\n// Listen to serial port\r\nfunction serialListener(debug)\r\n{\r\n    var receivedData = \"\";\r\n    serialPort = new SerialPort(portName, {\r\n        baudrate: 9600,\r\n        // defaults for Arduino serial communication\r\n         dataBits: 8,\r\n         parity: 'none',\r\n         stopBits: 1,\r\n         flowControl: false\r\n    });\r\n \r\n    serialPort.on(\"open\", function () {\r\n      console.log('open serial communication');\r\n            // Listens to incoming data\r\n        serialPort.on('data', function(data) {\r\n             receivedData += data.toString();\r\n          if (receivedData .indexOf('E') >= 0 && receivedData .indexOf('B') >= 0) {\r\n           sendData = receivedData .substring(receivedData .indexOf('B') + 1, receivedData .indexOf('E'));\r\n           receivedData = '';\r\n         }\r\n         // send the incoming data to browser with websockets.\r\n       socketServer.emit('update', sendData);\r\n      });  \r\n    });  \r\n}\r\n\r\nexports.start = startServer;"]],"start1":0,"start2":0,"length1":0,"length2":2615}]],"length":2615}
{"contributors":[],"silentsave":false,"ts":1390534594609,"patch":[[{"diffs":[[0," = '"],[-1,"COM3"],[1,"/dev/ttyACM0"],[0,"'; /"]],"start1":205,"start2":205,"length1":12,"length2":20}]],"length":2623,"saved":false}
{"contributors":[],"silentsave":false,"ts":1390534943201,"patch":[[{"diffs":[[0," = '';\r\n"],[1,"                  console.log('SendData = ' + sendData)\r\n\r\n"],[0,"        "]],"start1":2435,"start2":2435,"length1":16,"length2":75},{"diffs":[[0,"sendData);\r\n"],[1,"       console.log('SendData = ' + sendData)\r\n"],[0,"      });  \r"]],"start1":2613,"start2":2613,"length1":24,"length2":70}]],"length":2728,"saved":false}
{"contributors":[],"silentsave":false,"ts":1390534978569,"patch":[[{"diffs":[[0,"fs')"],[-1,"\r\n,"],[1,",\n    "],[0,"http"]],"start1":18,"start2":18,"length1":11,"length2":14},{"diffs":[[0,"'http'),"],[-1,"\r"],[0,"\n"],[1,"    "],[0,"socketio"]],"start1":43,"start2":43,"length1":18,"length2":21},{"diffs":[[0,"et.io'),"],[-1,"\r"],[0,"\n"],[1,"    "],[0,"url = re"]],"start1":80,"start2":80,"length1":18,"length2":21},{"diffs":[[0,"(\"url\"),"],[-1," \r\n"],[1,"\n    "],[0,"SerialPo"]],"start1":106,"start2":106,"length1":19,"length2":21},{"diffs":[[0,"rialPort"],[-1,"\r\n\r"],[1,"\n"],[0,"\nvar soc"]],"start1":156,"start2":156,"length1":19,"length2":17},{"diffs":[[0,"tServer;"],[-1,"\r"],[0,"\nvar ser"]],"start1":175,"start2":175,"length1":17,"length2":16},{"diffs":[[0,"ialPort;"],[-1,"\r"],[0,"\nvar por"]],"start1":191,"start2":191,"length1":17,"length2":16},{"diffs":[[0,"ino port"],[-1,"\r"],[0,"\nvar sen"]],"start1":257,"start2":257,"length1":17,"length2":16},{"diffs":[[0,"ta = \"\";"],[-1,"\r\n\r"],[1,"\n"],[0,"\n// hand"]],"start1":276,"start2":276,"length1":19,"length2":17},{"diffs":[[0,"thnames."],[-1,"\r"],[0,"\nfunctio"]],"start1":347,"start2":347,"length1":17,"length2":16},{"diffs":[[0,"ute,"],[1," "],[0,"handle,"],[1," "],[0,"debug)"],[-1,"\r\n{\r\n\t"],[1," {\n    "],[0,"// o"]],"start1":379,"start2":379,"length1":27,"length2":30},{"diffs":[[0,"st event"],[-1,"\r\n\t"],[1,"\n    "],[0,"function"]],"start1":416,"start2":416,"length1":19,"length2":21},{"diffs":[[0,"ponse) {"],[-1,"\r\n\t"],[1,"\n      "],[0,"  // par"]],"start1":460,"start2":460,"length1":19,"length2":23},{"diffs":[[0,"compared"],[-1,"\r\n\t"],[1,"\n      "],[0,"  // in "]],"start1":536,"start2":536,"length1":19,"length2":23},{"diffs":[[0,"ge will "],[-1,"\r\n\t"],[1,"\n      "],[0,"  // com"]],"start1":615,"start2":615,"length1":19,"length2":23},{"diffs":[[0," given. "],[-1,"\r\n\t"],[1,"\n      "],[0,"  var pa"]],"start1":667,"start2":667,"length1":19,"length2":23},{"diffs":[[0,"athname;"],[-1," \r\n\t"],[1,"\n      "],[0,"  consol"]],"start1":723,"start2":723,"length1":20,"length2":23},{"diffs":[[0,"eived\");"],[-1,"\r\n\t"],[1,"\n      "],[0,"  var co"]],"start1":785,"start2":785,"length1":19,"length2":23},{"diffs":[[0,"(handle,"],[1," "],[0,"pathname"]],"start1":821,"start2":821,"length1":16,"length2":17},{"diffs":[[0,"athname,"],[1," "],[0,"response"]],"start1":831,"start2":831,"length1":16,"length2":17},{"diffs":[[0,"nse,"],[1," "],[0,"request,"],[1," "],[0,"debug);"],[-1,"\r\n\t}\r\n\t\r\n\t"],[1,"\n    }\n\n    "],[0,"var "]],"start1":845,"start2":845,"length1":33,"length2":37},{"diffs":[[0,"nction()"],[-1,"{\r\n\t\t"],[1," {\n        "],[0,"console."]],"start1":939,"start2":939,"length1":21,"length2":27},{"diffs":[[0,":1337\");"],[-1,"\r\n\t\t"],[1,"\n        "],[0,"console."]],"start1":1001,"start2":1001,"length1":20,"length2":25},{"diffs":[[0,"p\");"],[-1,"\r\n\t}); \r\n\t"],[1,"\n    });\n    "],[0,"seri"]],"start1":1042,"start2":1042,"length1":18,"length2":21},{"diffs":[[0,"(debug);"],[-1,"\r\n\t"],[1,"\n    "],[0,"initSock"]],"start1":1073,"start2":1073,"length1":19,"length2":21},{"diffs":[[0,"ver,"],[1," "],[0,"debug);"],[-1,"\r"],[0,"\n}"],[-1,"\r\n\r"],[1,"\n"],[0,"\nfun"]],"start1":1106,"start2":1106,"length1":21,"length2":19},{"diffs":[[0,"ver,"],[1," "],[0,"debug)"],[-1,"\r\n{\r\n\t"],[1," {\n    "],[0,"sock"]],"start1":1151,"start2":1151,"length1":20,"length2":22},{"diffs":[[0,"er);"],[-1,"\r\n\t"],[1,"\n    "],[0,"if"],[1," "],[0,"(deb"]],"start1":1208,"start2":1208,"length1":13,"length2":16},{"diffs":[[0,"= false)"],[-1,"{\r\n\t\t"],[1," {\n        "],[0,"socketSe"]],"start1":1228,"start2":1228,"length1":21,"length2":27},{"diffs":[[0," off"],[-1,"\r\n\t}\r\n\t"],[1,"\n    }\n    "],[0,"sock"]],"start1":1299,"start2":1299,"length1":15,"length2":19},{"diffs":[[0,"function"],[-1," "],[0,"(socket)"]],"start1":1344,"start2":1344,"length1":17,"length2":16},{"diffs":[[0,"ocket) {"],[-1,"\r\n\t"],[1,"\n        "],[0,"console."]],"start1":1354,"start2":1354,"length1":19,"length2":25},{"diffs":[[0,"ected\");"],[-1,"\r\n\t"],[1,"\n        "],[0,"socket.e"]],"start1":1393,"start2":1393,"length1":19,"length2":25},{"diffs":[[0,"tion', {"],[1,"\n            "],[0,"pollOneV"]],"start1":1431,"start2":1431,"length1":16,"length2":29},{"diffs":[[0,"lue:"],[1," "],[0,"sendData"],[-1,"});\r\n\t"],[1,"\n        });\n        "],[0,"sock"]],"start1":1461,"start2":1461,"length1":22,"length2":38},{"diffs":[[0,"(data) {"],[-1,"\r\n\t"],[1,"\n            "],[0,"socket.e"]],"start1":1529,"start2":1529,"length1":19,"length2":29},{"diffs":[[0,"teData',"],[-1,"{"],[1," {\n                "],[0,"pollOneV"]],"start1":1567,"start2":1567,"length1":17,"length2":35},{"diffs":[[0,"lue:"],[1," "],[0,"data"],[-1,"});\r\n\t});\r\n\t"],[1,"\n            });\n        });\n        "],[0,"sock"]],"start1":1603,"start2":1603,"length1":24,"length2":50},{"diffs":[[0,"function(data) {"],[-1,"\r\n\t\t"],[1,"\n            "],[0,"serialPort.write"]],"start1":1672,"start2":1672,"length1":36,"length2":45},{"diffs":[[0," + 'E');"],[-1,"\r\n\t});\r\n\t"],[1,"\n        });\n        "],[0,"socket.o"]],"start1":1722,"start2":1722,"length1":25,"length2":37},{"diffs":[[0,"a) {"],[-1,"\r\n\t\t"],[1,"\n            "],[0,"seri"]],"start1":1786,"start2":1786,"length1":12,"length2":21},{"diffs":[[0,"P');"],[-1,"\r\n\t});\r\n\t\r"],[1,"\n        });\n"],[0,"\n    });"],[-1,"\r"],[0,"\n}"],[-1,"\r\n\r"],[1,"\n"],[0,"\n// "]],"start1":1828,"start2":1828,"length1":32,"length2":32},{"diffs":[[0,"ial port"],[-1,"\r"],[0,"\nfunctio"]],"start1":1873,"start2":1873,"length1":17,"length2":16},{"diffs":[[0,"bug)"],[-1,"\r\n{\r"],[1," {"],[0,"\n   "]],"start1":1908,"start2":1908,"length1":12,"length2":10},{"diffs":[[0,"ta = \"\";"],[-1,"\r"],[0,"\n    ser"]],"start1":1933,"start2":1933,"length1":17,"length2":16},{"diffs":[[0,"tName, {"],[-1,"\r"],[0,"\n       "]],"start1":1977,"start2":1977,"length1":17,"length2":16},{"diffs":[[0,"e: 9600,"],[-1,"\r"],[0,"\n       "]],"start1":2001,"start2":2001,"length1":17,"length2":16},{"diffs":[[0,"nication"],[-1,"\r\n "],[1,"\n"],[0,"        "]],"start1":2054,"start2":2054,"length1":19,"length2":17},{"diffs":[[0,"Bits: 8,"],[-1,"\r"],[0,"\n       "]],"start1":2075,"start2":2075,"length1":17,"length2":16},{"diffs":[[0,"        "],[-1," "],[0,"parity: "]],"start1":2084,"start2":2084,"length1":17,"length2":16},{"diffs":[[0," 'none',"],[-1,"\r\n "],[1,"\n"],[0,"        "]],"start1":2099,"start2":2099,"length1":19,"length2":17},{"diffs":[[0,"Bits: 1,"],[-1,"\r\n "],[1,"\n"],[0,"        "]],"start1":2120,"start2":2120,"length1":19,"length2":17},{"diffs":[[0,"alse"],[-1,"\r"],[0,"\n    });"],[-1,"\r\n \r"],[1,"\n"],[0,"\n   "]],"start1":2151,"start2":2151,"length1":21,"length2":17},{"diffs":[[0,"tion"],[-1," "],[0,"() {"],[-1,"\r"],[0,"\n"],[1,"  "],[0,"    "]],"start1":2195,"start2":2195,"length1":15,"length2":15},{"diffs":[[0,"ation');"],[-1,"\r\n   "],[1,"\n"],[0,"        "],[-1," "],[0,"// Liste"]],"start1":2245,"start2":2245,"length1":30,"length2":25},{"diffs":[[0,"ing data"],[-1,"\r"],[0,"\n       "]],"start1":2281,"start2":2281,"length1":17,"length2":16},{"diffs":[[0,"(data) {"],[-1,"\r\n "],[1,"\n"],[0,"        "]],"start1":2328,"start2":2328,"length1":19,"length2":17},{"diffs":[[0,"tring();"],[-1,"\r"],[0,"\n"],[1,"  "],[0,"        "]],"start1":2373,"start2":2373,"length1":18,"length2":19},{"diffs":[[0,"if (receivedData"],[-1," "],[0,".indexOf('E') >="]],"start1":2394,"start2":2394,"length1":33,"length2":32},{"diffs":[[0," && receivedData"],[-1," "],[0,".indexOf('B') >="]],"start1":2428,"start2":2428,"length1":33,"length2":32},{"diffs":[[0," >= 0) {"],[-1,"\r"],[0,"\n"],[1,"     "],[0,"        "]],"start1":2457,"start2":2457,"length1":18,"length2":22},{"diffs":[[0,"ivedData"],[-1," "],[0,".substri"]],"start1":2497,"start2":2497,"length1":17,"length2":16},{"diffs":[[0,"ing(receivedData"],[-1," "],[0,".indexOf('B') + "]],"start1":2512,"start2":2512,"length1":33,"length2":32},{"diffs":[[0,"ivedData"],[-1," "],[0,".indexOf"]],"start1":2551,"start2":2551,"length1":17,"length2":16},{"diffs":[[0,"f('E'));"],[-1,"\r"],[0,"\n"],[1,"    "],[0,"        "]],"start1":2566,"start2":2566,"length1":18,"length2":21},{"diffs":[[0,"\n               "],[1," "],[0,"receivedData = '"]],"start1":2574,"start2":2574,"length1":32,"length2":33},{"diffs":[[0,"ta = '';"],[-1,"\r\n  "],[1,"\n"],[0,"        "]],"start1":2601,"start2":2601,"length1":20,"length2":17},{"diffs":[[0,"endData)"],[-1,"\r\n\r\n"],[1,"\n\n "],[0,"        "]],"start1":2655,"start2":2655,"length1":20,"length2":19},{"diffs":[[0,"        "],[-1,"}\r\n"],[1,"  }\n   "],[0,"        "]],"start1":2667,"start2":2667,"length1":19,"length2":23},{"diffs":[[0,"sockets."],[-1,"\r"],[0,"\n"],[1,"     "],[0,"       s"]],"start1":2736,"start2":2736,"length1":18,"length2":22},{"diffs":[[0,"ta);"],[-1,"\r"],[0,"\n"],[1,"  "],[0,"       "],[1,"   "],[0,"cons"]],"start1":2791,"start2":2791,"length1":17,"length2":21},{"diffs":[[0,"endData)"],[-1,"\r"],[0,"\n"],[1,"  "],[0,"      })"]],"start1":2837,"start2":2837,"length1":18,"length2":19},{"diffs":[[0," });"],[-1,"  \r"],[0,"\n    });"],[-1,"  \r\n}\r\n\r"],[1,"\n}\n"],[0,"\nexp"]],"start1":2853,"start2":2853,"length1":27,"length2":19}]],"length":2897,"saved":false}
{"ts":1390534986671,"patch":[[{"diffs":[[0,"debug =="],[1,"="],[0," false) "]],"start1":1221,"start2":1221,"length1":16,"length2":17}]],"length":2898,"saved":false}

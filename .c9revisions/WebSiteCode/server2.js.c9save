{"ts":1390515547887,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"var fs = require('fs')\r\n,http = require('http'),\r\nsocketio = require('socket.io'),\r\nurl = require(\"url\"), \r\nSerialPort = require(\"serialport\").SerialPort\r\n\r\nvar socketServer;\r\nvar serialPort;\r\nvar portName = 'COM3'; //change this to your Arduino port\r\nvar sendData = \"\";\r\n\r\n// handle contains locations to browse to (vote and poll); pathnames.\r\nfunction startServer(route,handle,debug)\r\n{\r\n\t// on request event\r\n\tfunction onRequest(request, response) {\r\n\t  // parse the requested url into pathname. pathname will be compared\r\n\t  // in route.js to handle (var content), if it matches the a page will \r\n\t  // come up. Otherwise a 404 will be given. \r\n\t  var pathname = url.parse(request.url).pathname; \r\n\t  console.log(\"Request for \" + pathname + \" received\");\r\n\t  var content = route(handle,pathname,response,request,debug);\r\n\t}\r\n\t\r\n\tvar httpServer = http.createServer(onRequest).listen(1337, function(){\r\n\t\tconsole.log(\"Listening at: http://localhost:1337\");\r\n\t\tconsole.log(\"Server is up\");\r\n\t}); \r\n\tserialListener(debug);\r\n\tinitSocketIO(httpServer,debug);\r\n}\r\n\r\nfunction initSocketIO(httpServer,debug)\r\n{\r\n\tsocketServer = socketio.listen(httpServer);\r\n\tif(debug == false){\r\n\t\tsocketServer.set('log level', 1); // socket IO debug off\r\n\t}\r\n\tsocketServer.on('connection', function (socket) {\r\n\tconsole.log(\"user connected\");\r\n\tsocket.emit('onconnection', {pollOneValue:sendData});\r\n\tsocketServer.on('update', function(data) {\r\n\tsocket.emit('updateData',{pollOneValue:data});\r\n\t});\r\n\tsocket.on('buttonval', function(data) {\r\n\t\tserialPort.write(data + 'E');\r\n\t});\r\n\tsocket.on('sliderval', function(data) {\r\n\t\tserialPort.write(data + 'P');\r\n\t});\r\n\t\r\n    });\r\n}\r\n\r\n// Listen to serial port\r\nfunction serialListener(debug)\r\n{\r\n    var receivedData = \"\";\r\n    serialPort = new SerialPort(portName, {\r\n        baudrate: 9600,\r\n        // defaults for Arduino serial communication\r\n         dataBits: 8,\r\n         parity: 'none',\r\n         stopBits: 1,\r\n         flowControl: false\r\n    });\r\n \r\n    serialPort.on(\"open\", function () {\r\n      console.log('open serial communication');\r\n            // Listens to incoming data\r\n        serialPort.on('data', function(data) {\r\n             receivedData += data.toString();\r\n          if (receivedData .indexOf('E') >= 0 && receivedData .indexOf('B') >= 0) {\r\n           sendData = receivedData .substring(receivedData .indexOf('B') + 1, receivedData .indexOf('E'));\r\n           receivedData = '';\r\n         }\r\n         // send the incoming data to browser with websockets.\r\n       socketServer.emit('update', sendData);\r\n      });  \r\n    });  \r\n}\r\n\r\nexports.start = startServer;"]],"start1":0,"start2":0,"length1":0,"length2":2615}]],"length":2615}
{"contributors":[],"silentsave":false,"ts":1390515563200,"patch":[[{"diffs":[[0,"fs')"],[-1,"\r\n,"],[1,",\n    "],[0,"http"]],"start1":18,"start2":18,"length1":11,"length2":14},{"diffs":[[0,"'http'),"],[-1,"\r"],[0,"\n"],[1,"    "],[0,"socketio"]],"start1":43,"start2":43,"length1":18,"length2":21},{"diffs":[[0,"et.io'),"],[-1,"\r"],[0,"\n"],[1,"    "],[0,"url = re"]],"start1":80,"start2":80,"length1":18,"length2":21},{"diffs":[[0,"(\"url\"),"],[-1," \r\n"],[1,"\n    "],[0,"SerialPo"]],"start1":106,"start2":106,"length1":19,"length2":21},{"diffs":[[0,"rialPort"],[-1,"\r\n\r"],[1,"\n"],[0,"\nvar soc"]],"start1":156,"start2":156,"length1":19,"length2":17},{"diffs":[[0,"tServer;"],[-1,"\r"],[0,"\nvar ser"]],"start1":175,"start2":175,"length1":17,"length2":16},{"diffs":[[0,"ialPort;"],[-1,"\r"],[0,"\nvar por"]],"start1":191,"start2":191,"length1":17,"length2":16},{"diffs":[[0,"ino port"],[-1,"\r"],[0,"\nvar sen"]],"start1":249,"start2":249,"length1":17,"length2":16},{"diffs":[[0,"ta = \"\";"],[-1,"\r\n\r"],[1,"\n"],[0,"\n// hand"]],"start1":268,"start2":268,"length1":19,"length2":17},{"diffs":[[0,"thnames."],[-1,"\r"],[0,"\nfunctio"]],"start1":339,"start2":339,"length1":17,"length2":16},{"diffs":[[0,"ute,"],[1," "],[0,"handle,"],[1," "],[0,"debug)"],[-1,"\r\n{\r\n\t"],[1," {\n    "],[0,"// o"]],"start1":371,"start2":371,"length1":27,"length2":30},{"diffs":[[0,"st event"],[-1,"\r\n\t"],[1,"\n    "],[0,"function"]],"start1":408,"start2":408,"length1":19,"length2":21},{"diffs":[[0,"ponse) {"],[-1,"\r\n\t"],[1,"\n      "],[0,"  // par"]],"start1":452,"start2":452,"length1":19,"length2":23},{"diffs":[[0,"compared"],[-1,"\r\n\t"],[1,"\n      "],[0,"  // in "]],"start1":528,"start2":528,"length1":19,"length2":23},{"diffs":[[0,"ge will "],[-1,"\r\n\t"],[1,"\n      "],[0,"  // com"]],"start1":607,"start2":607,"length1":19,"length2":23},{"diffs":[[0," given. "],[-1,"\r\n\t"],[1,"\n      "],[0,"  var pa"]],"start1":659,"start2":659,"length1":19,"length2":23},{"diffs":[[0,"ame;"],[-1," \r\n\t"],[1,"\n     "],[0,"  "],[1," "],[0,"cons"]],"start1":719,"start2":719,"length1":14,"length2":17},{"diffs":[[0,"eived\");"],[-1,"\r\n\t"],[1,"\n      "],[0,"  var co"]],"start1":777,"start2":777,"length1":19,"length2":23},{"diffs":[[0,"(handle,"],[1," "],[0,"pathname"]],"start1":813,"start2":813,"length1":16,"length2":17},{"diffs":[[0,"athname,"],[1," "],[0,"response"]],"start1":823,"start2":823,"length1":16,"length2":17},{"diffs":[[0,"nse,"],[1," "],[0,"request,"],[1," "],[0,"debug);"],[-1,"\r\n\t}\r\n\t\r\n\t"],[1,"\n    }\n\n    "],[0,"var "]],"start1":837,"start2":837,"length1":33,"length2":37},{"diffs":[[0,"nction()"],[-1,"{\r\n\t\t"],[1," {\n        "],[0,"console."]],"start1":931,"start2":931,"length1":21,"length2":27},{"diffs":[[0,":1337\");"],[-1,"\r\n\t\t"],[1,"\n        "],[0,"console."]],"start1":993,"start2":993,"length1":20,"length2":25},{"diffs":[[0,"p\");"],[-1,"\r\n\t}); \r\n\t"],[1,"\n    });\n    "],[0,"seri"]],"start1":1034,"start2":1034,"length1":18,"length2":21},{"diffs":[[0,"(debug);"],[-1,"\r\n\t"],[1,"\n    "],[0,"initSock"]],"start1":1065,"start2":1065,"length1":19,"length2":21},{"diffs":[[0,"ver,"],[1," "],[0,"debug);"],[-1,"\r"],[0,"\n}"],[-1,"\r\n\r"],[1,"\n"],[0,"\nfun"]],"start1":1098,"start2":1098,"length1":21,"length2":19},{"diffs":[[0,"ver,"],[1," "],[0,"debug)"],[-1,"\r\n{\r\n\t"],[1," {\n    "],[0,"sock"]],"start1":1143,"start2":1143,"length1":20,"length2":22},{"diffs":[[0,"er);"],[-1,"\r\n\t"],[1,"\n    "],[0,"if"],[1," "],[0,"(deb"]],"start1":1200,"start2":1200,"length1":13,"length2":16},{"diffs":[[0,"= false)"],[-1,"{\r\n\t\t"],[1," {\n        "],[0,"socketSe"]],"start1":1220,"start2":1220,"length1":21,"length2":27},{"diffs":[[0," off"],[-1,"\r\n\t}\r\n\t"],[1,"\n    }\n    "],[0,"sock"]],"start1":1291,"start2":1291,"length1":15,"length2":19},{"diffs":[[0,"function"],[-1," "],[0,"(socket)"]],"start1":1336,"start2":1336,"length1":17,"length2":16},{"diffs":[[0,"ocket) {"],[-1,"\r\n\t"],[1,"\n        "],[0,"console."]],"start1":1346,"start2":1346,"length1":19,"length2":25},{"diffs":[[0,"ected\");"],[-1,"\r\n\t"],[1,"\n        "],[0,"socket.e"]],"start1":1385,"start2":1385,"length1":19,"length2":25},{"diffs":[[0,"tion', {"],[1,"\n            "],[0,"pollOneV"]],"start1":1423,"start2":1423,"length1":16,"length2":29},{"diffs":[[0,"lue:"],[1," "],[0,"sendData"],[-1,"});\r\n\t"],[1,"\n        });\n        "],[0,"sock"]],"start1":1453,"start2":1453,"length1":22,"length2":38},{"diffs":[[0,"(data) {"],[-1,"\r\n\t"],[1,"\n            "],[0,"socket.e"]],"start1":1521,"start2":1521,"length1":19,"length2":29},{"diffs":[[0,"teData',"],[-1,"{"],[1," {\n                "],[0,"pollOneV"]],"start1":1559,"start2":1559,"length1":17,"length2":35},{"diffs":[[0,"lue:"],[1," "],[0,"data"],[-1,"});\r\n\t});\r\n\t"],[1,"\n            });\n        });\n        "],[0,"sock"]],"start1":1595,"start2":1595,"length1":24,"length2":50},{"diffs":[[0,"function(data) {"],[-1,"\r\n\t\t"],[1,"\n            "],[0,"serialPort.write"]],"start1":1664,"start2":1664,"length1":36,"length2":45},{"diffs":[[0," + 'E');"],[-1,"\r\n\t});\r\n\t"],[1,"\n        });\n        "],[0,"socket.o"]],"start1":1714,"start2":1714,"length1":25,"length2":37},{"diffs":[[0,"a) {"],[-1,"\r\n\t\t"],[1,"\n            "],[0,"seri"]],"start1":1778,"start2":1778,"length1":12,"length2":21},{"diffs":[[0,"P');"],[-1,"\r\n\t});\r\n\t\r"],[1,"\n        });\n"],[0,"\n    });"],[-1,"\r"],[0,"\n}"],[-1,"\r\n\r"],[1,"\n"],[0,"\n// "]],"start1":1820,"start2":1820,"length1":32,"length2":32},{"diffs":[[0,"ial port"],[-1,"\r"],[0,"\nfunctio"]],"start1":1865,"start2":1865,"length1":17,"length2":16},{"diffs":[[0,"bug)"],[-1,"\r\n{\r"],[1," {"],[0,"\n   "]],"start1":1900,"start2":1900,"length1":12,"length2":10},{"diffs":[[0,"ta = \"\";"],[-1,"\r"],[0,"\n    ser"]],"start1":1925,"start2":1925,"length1":17,"length2":16},{"diffs":[[0,"tName, {"],[-1,"\r"],[0,"\n       "]],"start1":1969,"start2":1969,"length1":17,"length2":16},{"diffs":[[0,"e: 9600,"],[-1,"\r"],[0,"\n       "]],"start1":1993,"start2":1993,"length1":17,"length2":16},{"diffs":[[0,"nication"],[-1,"\r"],[0,"\n       "]],"start1":2046,"start2":2046,"length1":17,"length2":16},{"diffs":[[0,"        "],[-1," "],[0,"dataBits"]],"start1":2055,"start2":2055,"length1":17,"length2":16},{"diffs":[[0,"Bits: 8,"],[-1,"\r\n "],[1,"\n"],[0,"        "]],"start1":2067,"start2":2067,"length1":19,"length2":17},{"diffs":[[0," 'none',"],[-1,"\r\n "],[1,"\n"],[0,"        "]],"start1":2091,"start2":2091,"length1":19,"length2":17},{"diffs":[[0,"Bits: 1,"],[-1,"\r\n "],[1,"\n"],[0,"        "]],"start1":2112,"start2":2112,"length1":19,"length2":17},{"diffs":[[0,"alse"],[-1,"\r"],[0,"\n    });"],[-1,"\r\n \r"],[1,"\n"],[0,"\n   "]],"start1":2143,"start2":2143,"length1":21,"length2":17},{"diffs":[[0,"tion"],[-1," "],[0,"() {"],[-1,"\r"],[0,"\n"],[1,"  "],[0,"    "]],"start1":2187,"start2":2187,"length1":15,"length2":15},{"diffs":[[0,"ation');"],[-1,"\r\n  "],[1,"\n"],[0,"        "],[-1,"  "],[0,"// Liste"]],"start1":2237,"start2":2237,"length1":30,"length2":25},{"diffs":[[0,"ing data"],[-1,"\r"],[0,"\n       "]],"start1":2273,"start2":2273,"length1":17,"length2":16},{"diffs":[[0,"(data) {"],[-1,"\r"],[0,"\n       "]],"start1":2320,"start2":2320,"length1":17,"length2":16},{"diffs":[[0,") {\n            "],[-1," "],[0,"receivedData += "]],"start1":2325,"start2":2325,"length1":33,"length2":32},{"diffs":[[0,"tring();"],[-1,"\r"],[0,"\n"],[1," "],[0,"        "]],"start1":2365,"start2":2365,"length1":18,"length2":18},{"diffs":[[0,"\n           "],[1," "],[0,"if (received"]],"start1":2373,"start2":2373,"length1":24,"length2":25},{"diffs":[[0,"if (receivedData"],[-1," "],[0,".indexOf('E') >="]],"start1":2386,"start2":2386,"length1":33,"length2":32},{"diffs":[[0," && receivedData"],[-1," "],[0,".indexOf('B') >="]],"start1":2420,"start2":2420,"length1":33,"length2":32},{"diffs":[[0," >= 0) {"],[-1,"\r"],[0,"\n"],[1,"   "],[0,"        "]],"start1":2449,"start2":2449,"length1":18,"length2":20},{"diffs":[[0,"        "],[1,"  "],[0,"sendData"]],"start1":2464,"start2":2464,"length1":16,"length2":18},{"diffs":[[0,"ivedData"],[-1," "],[0,".substri"]],"start1":2489,"start2":2489,"length1":17,"length2":16},{"diffs":[[0,"ing(receivedData"],[-1," "],[0,".indexOf('B') + "]],"start1":2504,"start2":2504,"length1":33,"length2":32},{"diffs":[[0,"ivedData"],[-1," "],[0,".indexOf"]],"start1":2543,"start2":2543,"length1":17,"length2":16},{"diffs":[[0,"f('E'));"],[-1,"\r"],[0,"\n"],[1," "],[0,"        "]],"start1":2558,"start2":2558,"length1":18,"length2":18},{"diffs":[[0,"));\n            "],[1,"    "],[0,"receivedData = '"]],"start1":2563,"start2":2563,"length1":32,"length2":36},{"diffs":[[0,"ta = '';"],[-1,"\r"],[0,"\n"],[1," "],[0,"        "]],"start1":2593,"start2":2593,"length1":18,"length2":18},{"diffs":[[0,"        "],[-1,"}\r\n"],[1,"  }\n   "],[0,"        "]],"start1":2604,"start2":2604,"length1":19,"length2":23},{"diffs":[[0,"ets."],[-1,"\r"],[0,"\n"],[1,"  "],[0,"       "],[1,"   "],[0,"sock"]],"start1":2677,"start2":2677,"length1":17,"length2":21},{"diffs":[[0,"ndData);"],[-1,"\r"],[0,"\n"],[1,"  "],[0,"      })"]],"start1":2724,"start2":2724,"length1":18,"length2":19},{"diffs":[[0," });"],[-1,"  \r"],[0,"\n    });"],[-1,"  \r\n}\r\n\r"],[1,"\n}\n"],[0,"\nexp"]],"start1":2740,"start2":2740,"length1":27,"length2":19}]],"length":2784,"saved":false}
{"ts":1390515573902,"patch":[[{"diffs":[[0,"debug =="],[1,"+"],[0," false) "]],"start1":1213,"start2":1213,"length1":16,"length2":17}]],"length":2785,"saved":false}
{"contributors":[],"silentsave":false,"ts":1390524832337,"patch":[[{"diffs":[[0," = '"],[-1,"COM3"],[1,"/dev/ttyACM0"],[0,"'; /"]],"start1":212,"start2":212,"length1":12,"length2":20}]],"length":2793,"saved":false}
